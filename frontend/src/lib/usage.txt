 # Utility functions, hooks, and shared logic